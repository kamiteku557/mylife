# mylife 要件一覧（チェック管理）

最終更新: 2026-03-01

## 使い方
- このファイルを「要件の正本」とする。
- 要件が満たされたら `[x]` にする。
- 受け入れ確認の証跡（PR、URL、ファイル）を `証跡` に残す。

## ステータス凡例
- `[ ]` 未着手
- `[x]` 完了

## A. 基盤・運用要件
- [x] RQ-OPS-001: React/FastAPI のモノレポでローカル起動できる
  - 受け入れ条件: Frontend と Backend がローカルで起動する
  - 証跡: `README.md`, `apps/frontend/*`, `apps/backend/app/main.py`
- [x] RQ-OPS-002: Supabase に接続したAPIでDB疎通確認できる
  - 受け入れ条件: API経由で Supabase DB 接続確認ができる
  - 証跡: `apps/backend/app/main.py`, `apps/backend/app/supabase_health.py`, `apps/backend/tests/test_supabase_connection_api.py`, `curl /api/v1/ops/supabase-db-health = 200`
- [x] RQ-OPS-003: 主要テーブルを作成する migration がある
  - 受け入れ条件: spec 記載の主要テーブル定義が migration に含まれる
  - 証跡: `supabase/migrations/0001_init.sql`
- [ ] RQ-OPS-004: 認証後のみ主要APIを利用できる
  - 受け入れ条件: Supabase Auth（メールリンク）でAPIが保護される
  - 証跡: 未記入
- [x] RQ-OPS-005: Free Tier 構成を固定（CF Pages + Render + Supabase）
  - 受け入れ条件: 構成ドキュメントとデプロイ設定が一致し Railway を使わない
  - 証跡: `docs/spec.md`, `docs/deploy-minimal.md`, `render.yaml`
- [x] RQ-OPS-006: `.env.example` があり、機密値をコミットしない
  - 受け入れ条件: Frontend/Backend に env テンプレートがあり secrets 非コミット
  - 証跡: `apps/backend/.env.example`, `apps/frontend/.env.example`
- [ ] RQ-OPS-007: Supabase 公開クライアントキーを publishable key に移行する
  - 受け入れ条件: 公開クライアント向け設定で anon key を使わず publishable key を利用する
  - 証跡: 未記入
- [ ] RQ-OPS-008: Supabase を含むローカル検証手順を整備する
  - 受け入れ条件: フロント/バック/API疎通をローカルで再現できる手順と必要なenv設定が文書化される
  - 対応タスク: BL-015
  - 証跡: 未記入
- [ ] RQ-OPS-009: Frontend の API ベースURL未設定時にフェイルファストする
  - 受け入れ条件: `VITE_API_BASE_URL` が未設定/空文字のとき、`localhost` へフォールバックせず設定不足がUI上で明示される
  - 対応タスク: BL-016
  - 証跡: 未記入
- [x] RQ-OPS-010: Frontend/Backend を単一コマンドで同時起動できる
  - 受け入れ条件: 開発者がルートディレクトリで1コマンド実行するだけで Frontend と Backend のローカルサーバーを同時起動できる
  - 対応タスク: BL-018
  - 証跡: `Makefile`, `package.json`, `README.md`
- [ ] RQ-OPS-011: worktree 利用時の依存セットアップとポート運用を標準化する
  - 受け入れ条件: 開発は worktree 利用を基本とする運用方針が文書化される
  - 受け入れ条件: 新規 worktree 作成直後に実施すべき初期化コマンド（frontend/backend）が手順化される
  - 受け入れ条件: 各 worktree で `pnpm install` と `cd apps/backend && uv sync` を実施する手順が明記される
  - 受け入れ条件: 各 worktree で pre-commit hook を有効化（`pnpm precommit:install`）する手順が明記される
  - 受け入れ条件: worktree ごとの開発サーバーポート割り当てルールが定義される
  - 受け入れ条件: 最低限の事前確認（`eslint -v`, `lsof` など）で作業開始可否を判定できる
  - 対応タスク: BL-027, BL-036
  - 証跡: 未記入
- [x] RQ-OPS-012: オフライン同期キューを再利用可能な共通モジュールとして提供する
  - 受け入れ条件: localStorage 永続化 + 同期待ちキュー + 再送制御を抽象化した共通モジュールが frontend で利用できる
  - 受け入れ条件: メモ機能は共通モジュールを利用して実装され、機能固有ロジック（payload/merge/表示）と分離される
  - 受け入れ条件: 将来のポモドーロ等でも再利用できる API 形状（エンティティ種別依存の型パラメータ）になっている
  - 対応タスク: BL-033
  - 証跡: `apps/frontend/src/offlineSync/createQueue.ts`, `apps/frontend/src/memoOfflineSync.ts`, `apps/frontend/src/App.tsx`, `docs/backlog.md`
- [x] RQ-OPS-013: 同期待ちキューの保存構造を正規化し、重複データを最小化する
  - 受け入れ条件: pending キューは `payload` と最小メタ情報のみを保持し、表示用 `preview` は復元時に再生成できる
  - 受け入れ条件: 既存の旧形式キュー（preview含む）を読んでも動作を維持できる
  - 受け入れ条件: memo 作成・再送・置換フローの機能差分がない
  - 対応タスク: BL-034
  - 証跡: `apps/frontend/src/memoOfflineSync.ts`, `apps/frontend/src/offlineSync/createQueue.ts`, `apps/frontend/src/App.tsx`, `apps/frontend/src/memoOfflineSync.test.ts`, `docs/offline-sync-flow.md`
- [ ] RQ-OPS-014: 無料運用で背景Push通知を定期実行できる
  - 受け入れ条件: GitHub Actions の `schedule` を使い、5分間隔で背景Push dispatch を実行できる
  - 受け入れ条件: dispatch は秘密トークンで保護され、公開エンドポイントとして悪用されない
  - 受け入れ条件: 無料枠前提の運用制約（遅延許容、実行時間監視、secret設定）が docs に記載される
  - 対応タスク: BL-038
  - 証跡: 未記入

## B. MVP機能要件
- [x] RQ-POM-001: ポモドーロ設定（取得/更新）ができる
  - 受け入れ条件: focus/short/long/long_break_every を保存・取得できる
  - 対応タスク: BL-003
  - 証跡: `apps/backend/app/pomodoro.py`, `apps/backend/app/main.py`, `apps/backend/tests/test_pomodoro_api.py`, `apps/frontend/src/App.tsx`, `docs/backlog.md`
- [x] RQ-POM-002: ポモドーロ開始/停止/再開/終了ができる
  - 受け入れ条件: running/paused/completed/cancelled が正しく永続化される
  - 対応タスク: BL-004
  - 証跡: `apps/backend/app/pomodoro.py`, `apps/backend/app/main.py`, `apps/backend/tests/test_pomodoro_api.py`, `apps/frontend/src/SessionView.tsx`, `docs/backlog.md`
- [x] RQ-POM-003: タイマーUIで状態遷移できる
  - 受け入れ条件: 作業/休憩の遷移と開始・一時停止・再開・終了が可能
  - 対応タスク: BL-005
  - 証跡: `apps/frontend/src/App.tsx`, `apps/frontend/src/SessionView.tsx`, `apps/frontend/src/styles.css`, `docs/backlog.md`
- [ ] RQ-POM-004: ポモドーロ集計（日/週/月）が見られる
  - 受け入れ条件: APIとUIで期間別集計を表示できる
  - 証跡: 未記入
- [x] RQ-POM-005: ポモドーロの時間到達通知をブラウザ通知で受け取れる
  - 受け入れ条件: セッションが計画時間に到達（`00:00`）した時点でブラウザ通知が表示される
  - 受け入れ条件: 計画時間超過後は15分ごとにブラウザ通知が表示される
  - 受け入れ条件: 計画時間超過後はタイマー表示が `00:00` 固定ではなく、超過経過時間（`00:01`, `10:00`, `15:00` ...）を表示する
  - 受け入れ条件: 各通知タイミングで通知音が再生される
  - 受け入れ条件: 通知音実装は将来的に音声ファイル再生方式へ差し替えやすい構造である
  - 対応タスク: BL-031
  - 証跡: `apps/frontend/src/SessionView.tsx`, `docs/backlog.md`, `pnpm --filter mylife-frontend build`
- [ ] RQ-POM-006: iOS PWA 復帰時にタイマー経過を正しく追従できる
  - 受け入れ条件: iOS で別アプリへ切り替え後に復帰した際、表示タイマーが経過時間を反映して補正される
  - 受け入れ条件: 00:00 到達後の超過表示（負値側）も復帰時に継続して正しく表示される
  - 受け入れ条件: 実装は `setInterval` の1秒減算だけに依存せず、経過実時間ベースで補正できる
  - 対応タスク: BL-037
  - 証跡: 未記入
- [ ] RQ-POM-007: iOS PWA で背景中のセッション通知を受け取れる
  - 受け入れ条件: iOS 16.4+ のホーム画面追加アプリで push 購読できる
  - 受け入れ条件: セッション 00:00 到達通知と 15分ごとの超過通知を背景中にも受信できる（最大5分遅延を許容）
  - 受け入れ条件: 通知の取りこぼし復帰時は未送信分を連投せず、最新到達分のみ通知する
  - 対応タスク: BL-038
  - 証跡: 未記入
- [x] RQ-MEM-001: メモログCRUD APIがある
  - 受け入れ条件: Markdown本文、日付、タグ、関連セッションを保存できる
  - 対応タスク: BL-006
  - 証跡: `apps/backend/app/main.py`, `apps/backend/app/memo_logs.py`, `apps/backend/tests/test_memo_logs_api.py`
- [x] RQ-MEM-002: メモ一覧/詳細/編集UIがある
  - 受け入れ条件: 作成・編集・閲覧・削除ができる
  - 対応タスク: BL-006
  - 証跡: `apps/frontend/src/App.tsx`, `apps/frontend/src/styles.css`
- [ ] RQ-MEM-003: タグでメモをフィルタできる
  - 受け入れ条件: タグ作成/紐づけ/絞り込みが可能
  - 証跡: 未記入
- [ ] RQ-MEM-004: メモ集計（期間/タグ）を表示できる
  - 受け入れ条件: 件数を期間別・タグ別に表示できる
  - 証跡: 未記入
- [ ] RQ-MEM-006: メモログUIをデザインモック準拠へ更新する
  - 受け入れ条件: 作成フォーム、タグ入力、時系列一覧、編集/削除操作がデザインと同等の画面機能で提供される
  - 受け入れ条件: メモ一覧の編集/削除アイコンは日付の右隣へ横並び配置され、行の縦長化を抑制できる
  - 対応タスク: BL-014
  - 証跡: 未記入
- [x] RQ-MEM-007: メモログ表示設定をユーザーが調整できる
  - 受け入れ条件: メモ記入画面での過去メモ表示数を設定でき、デフォルト値は20件である
  - 受け入れ条件: メモ文字サイズを設定でき、デフォルト値は現行より大きい
  - 対応タスク: BL-017
  - 証跡: `apps/frontend/src/App.tsx`, `apps/frontend/src/styles.css`, `docs/backlog.md`
- [ ] RQ-MEM-008: メモ作成UIの保存導線をモバイル操作向けに最適化する
  - 受け入れ条件: iPhone幅でメモ作成フォームの Save ボタンが横長（フォーム幅に追従）で表示される
  - 受け入れ条件: メモ作成フォームから `Ctrl + Enter to save` の文言が表示されない
  - 対応タスク: BL-024
  - 証跡: 未記入
- [x] RQ-MEM-009: メモ一覧の件数表示を表示件数のみで簡潔に示す
  - 受け入れ条件: メモ一覧上部のステータス文言が「x件を表示」形式で表示される
  - 受け入れ条件: 総件数を併記しない
  - 受け入れ条件: メモ一覧 API は `limit` 指定で件数を制限して取得できる
  - 受け入れ条件: `limit` の境界値（1, 100, 0, 101）に対する API 応答がテストで担保される
  - 対応タスク: BL-030
  - 証跡: `apps/frontend/src/App.tsx`, `apps/backend/app/main.py`, `apps/backend/app/memo_logs.py`, `apps/backend/tests/test_memo_logs_api.py`, `docs/backlog.md`
- [x] RQ-MEM-010: メモログの初回表示と保存でローカルキャッシュを使った体感速度改善を行う
  - 受け入れ条件: 初回表示時に `localStorage` のキャッシュ済みメモを先に描画し、その後に API 同期で更新できる
  - 受け入れ条件: 新規メモ作成時に UI へ即時反映し、Supabase 登録完了後にサーバー確定データへ置換できる
  - 受け入れ条件: API 失敗時でも一時保存データ（同期待ち）を保持し、再同期を試行できる
  - 対応タスク: BL-032, BL-033, BL-034
  - 証跡: `apps/frontend/src/App.tsx`, `apps/frontend/src/memoOfflineSync.ts`, `apps/frontend/src/offlineSync/createQueue.ts`, `docs/offline-sync-flow.md`
- [x] RQ-MEM-005: メモ保存の体感遅延を許容範囲に抑える
  - 受け入れ条件: 初回保存時のボトルネックを特定し、不要な待ち時間を削減できる
  - 対応タスク: BL-012
  - 進捗: BL-012 Done (2026-02-27)
  - 証跡: `apps/backend/app/memo_logs.py`, `apps/backend/tests/test_memo_logs_api.py`, `apps/backend/tests/test_supabase_connection_api.py`
- [x] RQ-SET-001: 設定画面でメモログ設定とセッション設定を一元管理できる
  - 受け入れ条件: 設定画面から「メモログ」「セッション」の設定ブロックにアクセスできる
  - 受け入れ条件: メモログ設定で表示数と文字サイズを変更できる
  - 対応タスク: BL-017
  - 証跡: `apps/frontend/src/App.tsx`, `apps/frontend/src/styles.css`, `docs/backlog.md`
- [ ] RQ-DIA-001: 日記CRUD APIがある
  - 受け入れ条件: 日付キーで1日1件を保存・更新できる
  - 証跡: 未記入
- [ ] RQ-DIA-002: 日記一覧/編集UIがある
  - 受け入れ条件: 日記の作成・編集・閲覧ができる
  - 証跡: 未記入
- [ ] RQ-EXP-001: MarkdownエクスポートAPIがある
  - 受け入れ条件: 期間・種別指定で Markdown または zip を生成できる
  - 証跡: 未記入
- [ ] RQ-EXP-002: UIからエクスポートできる
  - 受け入れ条件: 設定画面の操作でダウンロードできる
  - 証跡: 未記入
- [ ] RQ-EXP-003: 出力品質（UTF-8、日本語、改行、リンク）を満たす
  - 受け入れ条件: 文字化けや構造崩れがない
  - 証跡: 未記入
- [ ] RQ-EXP-004: 週1バックアップ手順が運用ガイドにある
  - 受け入れ条件: docs 内に実施手順が明記される
  - 証跡: 未記入

## C. 品質・ガードレール要件
- [x] RQ-GRD-001: 添付ファイル機能をMVP対象外とする
  - 受け入れ条件: Storage増大につながる要件がMVP外で固定される
  - 証跡: `docs/spec.md`
- [x] RQ-GRD-002: 集計はオンデマンド（定期バッチなし）
  - 受け入れ条件: cron/scheduler が不要な設計である
  - 証跡: `docs/spec.md`, `docs/free-tier-checklist.md`
- [x] RQ-GRD-003: 無料枠チェックリストがある
  - 受け入れ条件: デプロイ前確認項目が文書化されている
  - 証跡: `docs/free-tier-checklist.md`
- [x] RQ-QLT-001: Backend に網羅的な単体/結合テストがある
  - 受け入れ条件: サービス層の主要ロジック（正規化・時刻計算・状態遷移・境界値）を単体テストで検証できる
  - 受け入れ条件: 主要APIの正常/異常系を結合テストで検証できる
  - 対応タスク: BL-009（全体）, BL-006（メモAPI・SupabaseヘルスAPIのDIテスト化）, BL-035（網羅化）
  - 証跡: `apps/backend/tests/test_memo_logs_unit.py`, `apps/backend/tests/test_pomodoro_unit.py`, `apps/backend/tests/test_memo_logs_integration_api.py`, `apps/backend/tests/test_pomodoro_integration_api.py`, `pnpm test`
- [x] RQ-QLT-002: Frontend に網羅的な単体/結合テストがある
  - 受け入れ条件: 主要UIロジック（設定値丸め込み・タグ正規化・Markdown描画・テーマ切替）を単体テストで検証できる
  - 受け入れ条件: 主要画面導線（メモ作成/編集/削除、設定更新）を結合テストで検証できる
  - 対応タスク: BL-009（全体）, BL-035（網羅化）, BL-037（ビルド互換性修正）
  - 証跡: `apps/frontend/src/App.utils.test.ts`, `apps/frontend/src/useTheme.test.tsx`, `apps/frontend/src/App.integration.test.tsx`, `pnpm test`, `pnpm --filter mylife-frontend build`
- [x] RQ-QLT-003: 主要導線を検証するE2Eテストがある
  - 受け入れ条件: ユーザー操作ベースでメモ主要導線（表示/作成/編集開始）をE2Eテストで検証できる
  - 受け入れ条件: ユーザー操作ベースでセッション主要導線（開始/一時停止/再開/完了）をE2Eテストで検証できる
  - 受け入れ条件: E2Eテストをローカルで再現可能な実行コマンドが整備される
  - 対応タスク: BL-009（全体）, BL-035（網羅化）
  - 証跡: `apps/frontend/e2e/memo-flow.spec.ts`, `apps/frontend/e2e/session-flow.spec.ts`, `playwright.config.ts`, `pnpm test:e2e`
- [ ] RQ-QLT-004: モバイル幅で主要画面が崩れない
  - 受け入れ条件: iPhone幅で主要画面が操作可能
  - 対応タスク: BL-010, BL-023, BL-024
  - 証跡: 未記入
- [x] RQ-QLT-005: ダークモードをOS連動 + 手動上書きで切り替えできる
  - 受け入れ条件: 初期表示は `prefers-color-scheme` を反映し、ユーザー操作で Light/Dark を切り替えできる
  - 受け入れ条件: 手動選択したテーマは永続化され、再訪時に同じテーマで表示される
  - 受け入れ条件: テーマ切替実装は配色トークンが整理され、テーマ状態管理ロジックがUI本体から分離されている
  - 対応タスク: BL-028, BL-029
  - 証跡: `apps/frontend/src/App.tsx`, `apps/frontend/src/styles.css`, `apps/frontend/src/useTheme.ts`, `docs/backlog.md`
- [x] RQ-QLT-006: オフライン同期キューのフロントエンドテストを整備する
  - 受け入れ条件: キュー追加、同期成功、同期失敗継続、再起動後復元、重複防止の主要ケースを自動テストで検証できる
  - 受け入れ条件: テスト実行コマンドが frontend package scripts から実行できる
  - 対応タスク: BL-033, BL-034
  - 証跡: `apps/frontend/src/offlineSync/createQueue.test.ts`, `apps/frontend/src/memoOfflineSync.test.ts`, `apps/frontend/package.json`, `pnpm test`
- [x] RQ-QLT-007: 実装タスクごとにテストを継続追加する開発ルールがある
  - 受け入れ条件: 開発フローに「各BLで単体/結合/E2Eの追加・更新要否を判定し、必要分を同一タスク内で追加する」ルールが明記されている
  - 受け入れ条件: 完了前チェックでテスト追加有無を確認できる
  - 受け入れ条件: pre-commit 実行時に Backend/Frontend の全テストが自動実行される
  - 受け入れ条件: `main` マージ前に E2E テスト（`pnpm test:e2e`）を実行するルールが明記される
  - 対応タスク: BL-035, BL-036, BL-038（frontend typecheck hook 追加）
  - 証跡: `docs/development-workflow.md`, `.pre-commit-config.yaml`, `pnpm precommit:run`, `cd apps/backend && uv run pre-commit run frontend-typecheck --all-files`, `pnpm test:e2e`
- [x] RQ-DOC-001: Docstring とコードコメントの記述言語ルールが定義されている
  - 受け入れ条件: `AGENTS.md` にルールが明記され、実装コードの Docstring/コメントがルールに準拠している
  - 対応タスク: BL-013
  - 証跡: `AGENTS.md`, `apps/backend/app/main.py`, `apps/backend/app/memo_logs.py`, `apps/backend/app/supabase_health.py`, `apps/backend/tests/test_memo_logs_api.py`, `apps/backend/tests/test_supabase_connection_api.py`, `apps/frontend/src/App.tsx`

## MVP完了条件
- [ ] ポモドーロ・メモ・日記の主要フローが実行可能
- [ ] データが永続化される
- [ ] Markdownエクスポート可能
- [ ] モバイル幅で操作可能
- [ ] Cloudflare Pages + Render Free + Supabase Free で動作する
- [ ] Railway未使用で運用できる

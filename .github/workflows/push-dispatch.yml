name: Push Dispatch

on:
  schedule:
    - cron: "*/5 * * * *"
  workflow_dispatch:

jobs:
  dispatch:
    concurrency:
      group: push-dispatch
      cancel-in-progress: true
    runs-on: ubuntu-latest
    timeout-minutes: 1
    steps:
      - name: Validate secrets
        run: |
          test -n "${{ secrets.PUSH_DISPATCH_URL }}"
          test -n "${{ secrets.PUSH_DISPATCH_TOKEN }}"
      - name: Call push dispatch API
        run: |
          curl --fail --show-error --silent \
            --connect-timeout 5 \
            --max-time 20 \
            -X POST \
            -H "X-Dispatch-Token: ${{ secrets.PUSH_DISPATCH_TOKEN }}" \
            "${{ secrets.PUSH_DISPATCH_URL }}"
